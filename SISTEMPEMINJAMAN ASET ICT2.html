<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Pinjaman ICT - SK Sri Aman</title>
    <!-- Muat turun Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Muat turun Fon Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Muat turun Tone.js (untuk notifikasi bunyi) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    
    <style>
        /* Tetapkan fon lalai */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F0F9FF; /* bg-blue-50 */
        }
        /* Sembunyikan 'number' input spinners */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
        /* Sembunyikan <details> marker */
        details > summary {
            list-style: none;
        }
        details > summary::-webkit-details-marker {
            display: none;
        }
        /* Gaya untuk Tab Aktif */
        .tab-button.active {
            border-color: #2563EB; /* blue-600 */
            color: #2563EB;
            background-color: #DBEAFE; /* blue-100 */
        }
        /* (BARU) Sembunyikan butiran aset secara lalai & transisi */
        .asset-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            background-color: #FAFAFA; /* Sedikit kelabu */
        }
        .asset-item-details.open .asset-details {
            max-height: 500px; /* Cukup besar untuk gambar & spec */
            transition: max-height 0.5s ease-in;
        }
        /* (BARU) Putar ikon info */
        .asset-item-details.open .info-icon {
            transform: rotate(180deg);
        }
        /* (BARU) Grid untuk item berkumpulan */
        .grouped-item-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 0.5rem; /* 8px */
        }
    </style>
</head>
<body class="leading-normal tracking-normal">

    <!-- Header -->
    <header class="bg-white shadow-md">
        <div class="container mx-auto px-4 py-6 flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-bold text-blue-800">Sistem Pinjaman Aset ICT</h1>
                <p id="school-name" class="text-lg font-semibold text-gray-700">SK SRI AMAN</p>
            </div>
            <div id="auth-container" class="flex items-center space-x-3">
                <span id="auth-status" class="text-sm text-gray-600 italic">Memuatkan...</span>
                <button id="login-button" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg shadow transition duration-200">
                    Log Masuk Admin
                </button>
                <button id="logout-button" class="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg shadow transition duration-200 hidden">
                    Log Keluar
                </button>
            </div>
        </div>
    </header>

    <!-- Konten Utama -->
    <main class="container mx-auto p-4 mt-6">

        <!-- Navigasi Tab -->
        <div class="mb-6">
            <div class="border-b border-gray-200">
                <nav id="tab-nav" class="-mb-px flex space-x-4" aria-label="Tabs">
                    <!-- Tab untuk Guru (Default) -->
                    <button data-tab="permohonan" class="tab-button active whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">
                        Permohonan
                    </button>
                    <!-- Tab untuk Semua -->
                    <button data-tab="aset" class="tab-button whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">
                        Aset Tersedia
                    </button>
                    <button data-tab="dipinjam" class="tab-button whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">
                        Aset Dipinjam
                    </button>
                    <!-- Tab untuk Admin (Tersembunyi) -->
                    <button data-tab="rekod" class="tab-button hidden whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">
                        Rekod Pinjaman
                        <!-- Badge Notifikasi -->
                        <span id="pending-badge" class="hidden ml-2 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-red-100 bg-red-600 rounded-full">0</span>
                    </button>
                </nav>
            </div>
        </div>

        <!-- Konten Tab -->
        <div id="tab-content">

            <!-- Panel 1: Permohonan -->
            <div id="panel-permohonan" class="tab-panel active">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Borang Permohonan -->
                    <section class="lg:col-span-1 bg-white shadow-md rounded-lg p-6 h-fit">
                        <h2 class="text-xl font-semibold mb-4 text-blue-600">Borang Permohonan</h2>
                        <form id="loan-form" class="space-y-4">
                            <div>
                                <label for="teacherName" class="block text-sm font-medium text-gray-700">Nama Guru</label>
                                <input type="text" id="teacherName" name="teacherName" required
                                       class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-gray-100">
                            </div>
                            <div>
                                <label for="teacherIC" class="block text-sm font-medium text-gray-700">No Kad Pengenalan</label>
                                <input type="text" id="teacherIC" name="teacherIC" placeholder="Cth: 800101-07-5000" required
                                       class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-gray-100">
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="startDate" class="block text-sm font-medium text-gray-700">Tarikh Pinjam</label>
                                    <input type="date" id="startDate" name="startDate" required
                                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-gray-100">
                                </div>
                                <div>
                                    <label for="endDate" class="block text-sm font-medium text-gray-700">Tarikh Pulang</label>
                                    <input type="date" id="endDate" name="endDate" required
                                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-gray-100">
                                </div>
                            </div>
                            <div>
                                <label for="purpose" class="block text-sm font-medium text-gray-700">Tujuan Pinjaman</label>
                                <textarea id="purpose" name="purpose" rows="3" required
                                          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-gray-100"></textarea>
                            </div>
                            <button type="submit" id="submit-button"
                                    class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg shadow transition duration-200">
                                Hantar Permohonan
                            </button>
                            <p id="submit-status-error" class="text-sm text-red-600 mt-2"></p>
                        </form>
                    </section>
                    <!-- Senarai Aset (untuk dipilih) -->
                    <section class="lg:col-span-2 space-y-6">
                        <div class="bg-white shadow-md rounded-lg p-6">
                            <h2 class="text-xl font-semibold mb-4 text-green-600">Pilih Item (Boleh Tanda Banyak)</h2>
                            <div class="space-y-2">
                                <!-- Kategori Laptop -->
                                <div class="border border-gray-200 rounded-lg">
                                    <summary class="flex justify-between items-center p-3 bg-gray-100 rounded-t-lg">
                                        <div class="flex items-center space-x-2">
                                            <span class="text-lg font-semibold text-gray-800">Laptop</span>
                                            <span id="form-laptop-count" class="hidden ml-2 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-blue-100 bg-blue-600 rounded-full">0</span>
                                        </div>
                                    </summary>
                                    <div id="form-laptop-list" class="space-y-2 p-4">
                                        <p class="text-gray-500 text-sm italic">Memuatkan...</p>
                                    </div>
                                </div>
                                <!-- Kategori Tablet -->
                                <div class="border border-gray-200 rounded-lg">
                                    <summary class="flex justify-between items-center p-3 bg-gray-100 rounded-t-lg">
                                        <div class="flex items-center space-x-2">
                                            <span class="text-lg font-semibold text-gray-800">Tablet</span>
                                            <span id="form-tablet-count" class="hidden ml-2 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-blue-100 bg-blue-600 rounded-full">0</span>
                                        </div>
                                    </summary>
                                    <div id="form-tablet-list" class="space-y-2 p-4">
                                        <p class="text-gray-500 text-sm italic">Memuatkan...</p>
                                    </div>
                                </div>
                                <!-- Kategori Projector -->
                                <div class="border border-gray-200 rounded-lg">
                                    <summary class="flex justify-between items-center p-3 bg-gray-100 rounded-t-lg">
                                        <div class="flex items-center space-x-2">
                                            <span class="text-lg font-semibold text-gray-800">Projector</span>
                                            <span id="form-projector-count" class="hidden ml-2 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-blue-100 bg-blue-600 rounded-full">0</span>
                                        </div>
                                    </summary>
                                    <div id="form-projector-list" class="space-y-2 p-4">
                                        <p class="text-gray-500 text-sm italic">Memuatkan...</p>
                                    </div>
                                </div>
                                <!-- Kategori Lain-lain -->
                                <div class="border border-gray-200 rounded-lg">
                                    <summary class="flex justify-between items-center p-3 bg-gray-100 rounded-t-lg">
                                        <div class="flex items-center space-x-2">
                                            <span class="text-lg font-semibold text-gray-800">Lain-lain</span>
                                            <span id="form-others-count" class="hidden ml-2 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-blue-100 bg-blue-600 rounded-full">0</span>
                                        </div>
                                    </summary>
                                    <div id="form-others-list" class="space-y-2 p-4">
                                        <p class="text-gray-500 text-sm italic">Memuatkan...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>

            <!-- Panel 2: Aset Tersedia (Paparan Sahaja) -->
            <div id="panel-aset" class="tab-panel hidden">
                <section class="space-y-6">
                    <div class="bg-white shadow-md rounded-lg p-6">
                        <h2 class="text-xl font-semibold mb-4 text-green-600">Senarai Aset Tersedia (Paparan Sahaja)</h2>
                        <div class="space-y-2">
                            <!-- Kategori Laptop -->
                            <div class="border border-gray-200 rounded-lg">
                                <summary class="flex justify-between items-center p-3 bg-gray-100 rounded-t-lg">
                                    <div class="flex items-center space-x-2">
                                        <span class="text-lg font-semibold text-gray-800">Laptop</span>
                                        <span id="display-laptop-count" class="hidden ml-2 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-blue-100 bg-blue-600 rounded-full">0</span>
                                    </div>
                                </summary>
                                <div id="display-laptop-list" class="space-y-2 p-4">
                                    <p class="text-gray-500 text-sm italic">Memuatkan...</p>
                                </div>
                            </div>
                            <!-- Kategori Tablet -->
                            <div class="border border-gray-200 rounded-lg">
                                <summary class="flex justify-between items-center p-3 bg-gray-100 rounded-t-lg">
                                    <div class="flex items-center space-x-2">
                                        <span class="text-lg font-semibold text-gray-800">Tablet</span>
                                        <span id="display-tablet-count" class="hidden ml-2 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-blue-100 bg-blue-600 rounded-full">0</span>
                                    </div>
                                </summary>
                                <div id="display-tablet-list" class="space-y-2 p-4">
                                    <p class="text-gray-500 text-sm italic">Memuatkan...</p>
                                </div>
                            </div>
                            <!-- Kategori Projector -->
                            <div class="border border-gray-200 rounded-lg">
                                <summary class="flex justify-between items-center p-3 bg-gray-100 rounded-t-lg">
                                    <div class="flex items-center space-x-2">
                                        <span class="text-lg font-semibold text-gray-800">Projector</span>
                                        <span id="display-projector-count" class="hidden ml-2 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-blue-100 bg-blue-600 rounded-full">0</span>
                                    </div>
                                </summary>
                                <div id="display-projector-list" class="space-y-2 p-4">
                                    <p class="text-gray-500 text-sm italic">Memuatkan...</p>
                                </div>
                            </div>
                            <!-- Kategori Lain-lain -->
                            <div class="border border-gray-200 rounded-lg">
                                <summary class="flex justify-between items-center p-3 bg-gray-100 rounded-t-lg">
                                    <div class="flex items-center space-x-2">
                                        <span class="text-lg font-semibold text-gray-800">Lain-lain</span>
                                        <span id="display-others-count" class="hidden ml-2 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-blue-100 bg-blue-600 rounded-full">0</span>
                                    </div>
                                </summary>
                                <div id="display-others-list" class="space-y-2 p-4">
                                    <p class="text-gray-500 text-sm italic">Memuatkan...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Panel 3: Aset Sedang Dipinjam (Public) -->
            <div id="panel-dipinjam" class="tab-panel hidden">
                <section class="bg-white shadow-md rounded-lg p-6">
                    <h2 class="text-xl font-semibold mb-4 text-red-600">Senarai Aset Sedang Dipinjam</h2>
                    <div id="borrowed-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <p class="text-gray-500 text-sm italic">Memuatkan...</p>
                    </div>
                </section>
            </div>
            
            <!-- Panel 4: Rekod Pinjaman (Admin Sahaja) -->
            <div id="panel-admin-rekod" class="tab-panel hidden">
                <!-- Konten Admin Panel akan dipindahkan ke sini oleh JavaScript -->
            </div>

        </div>

        <!-- Admin Panel (Struktur Asal, tersembunyi) -->
        <!-- Ia akan dipindahkan ke #panel-admin-rekod oleh JS jika admin log masuk -->
        <section id="admin-panel" class="lg:col-span-3 bg-white shadow-md rounded-lg p-6 hidden">
            
            <!-- Bahagian Pengurusan Aset -->
            <div class="mb-6 grid grid-cols-1 md:grid-cols-2 gap-4">
                
                <!-- Borang Tambah Aset Pukal (Accordion) -->
                <details class="border border-gray-200 rounded-lg bg-white">
                    <summary class="flex justify-between items-center p-4 cursor-pointer bg-gray-50 hover:bg-gray-100 rounded-t-lg">
                        <h3 class="text-lg font-semibold text-gray-800">Tambah Aset Pukal</h3>
                        <svg class="w-6 h-6 text-gray-600 transition-transform duration-200 transform group-open:rotate-90" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v6m3-3H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    </summary>
                    <form id="bulk-add-form" class="p-4 space-y-3">
                        <div>
                            <label for="baseName" class="block text-sm font-medium text-gray-700">Nama Asas</label>
                            <input type="text" id="baseName" placeholder="Cth: Tablet Makmal" required
                                   class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-gray-100">
                        </div>
                        <div>
                            <label for="groupName" class="block text-sm font-medium text-gray-700">Nama Kumpulan (Pilihan)</label>
                            <input type="text" id="groupName" placeholder="Cth: Joi Classmate (Untuk kumpul item)"
                                   class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-gray-100">
                        </div>
                        <div>
                            <label for="quantity" class="block text-sm font-medium text-gray-700">Jumlah</label>
                            <input type="number" id="quantity" min="1" max="100" placeholder="Cth: 34" required
                                   class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-gray-100">
                        </div>
                        <div>
                            <label for="category" class="block text-sm font-medium text-gray-700">Kategori</label>
                            <select id="category" required
                                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-gray-100">
                                <option value="">Pilih Kategori</option>
                                <option value="Laptop">Laptop</option>
                                <option value="Tablet">Tablet</option>
                                <option value="Projector">Projector</option>
                                <option value="Lain">Lain-lain</option>
                            </select>
                        </div>
                        <button type="submit" id="bulk-add-button"
                                class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg shadow transition duration-200">
                            Tambah Aset
                        </button>
                        <p id="bulk-add-status" class="text-sm mt-2"></p>
                    </form>
                </details>
                
                <!-- Butang Pengurus Aset -->
                <details class="border border-gray-200 rounded-lg bg-white">
                    <summary class="flex justify-between items-center p-4 cursor-pointer bg-gray-50 hover:bg-gray-100 rounded-t-lg">
                        <h3 class="text-lg font-semibold text-gray-800">Urus Aset Sedia Ada</h3>
                        <svg class="w-6 h-6 text-gray-600 transition-transform duration-200 transform group-open:rotate-90" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M10.343 3.94c.09-.542.56-.94 1.11-.94h1.093c.55 0 1.02.398 1.11.94l.149.894c.07.424.384.764.78.93.398.164.855.142 1.205-.08l.738-.46c.477-.298 1.043-.182 1.39.288l.548.74c.346.47.32.1.05.1l-.738.46c-.35.22-.564.606-.564 1.03v1.093c0 .424.214.81.564 1.03l.738.46c.47.29.527.92.18 1.39l-.548.74c-.347.47-.913.587-1.39.288l-.738-.46c-.35-.22-.806-.242-1.205-.08-.396.164-.71.506-.78.93l-.149.894c-.09.542-.56.94-1.11.94h-1.093c-.55 0-1.02-.398-1.11-.94l-.149-.894c-.07-.424-.384-.764-.78-.93-.398-.164-.855-.142-1.205.08l-.738.46c-.477.298-1.043.182-1.39-.288l-.548-.74c-.346-.47-.32-1.042.05-1.39l.738-.46c.35-.22.564-.606-.564-1.03V9.093c0-.424-.214-.81-.564-1.03l-.738-.46c-.47-.29-.527-.92-.18-1.39l.548-.74c.347-.47.913.587 1.39.288l.738.46c.35.22.806.242 1.205.08.396.164.71.506.78.93l.149.894z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                    </summary>
                    <div class="p-4">
                        <p class="text-sm text-gray-600 mb-3">Edit nama, kategori, URL gambar, atau spesifikasi untuk aset sedia ada.</p>
                        <button id="open-asset-manager-btn"
                                class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow transition duration-200">
                            Buka Pengurus Aset
                        </button>
                    </div>
                </details>
            </div>
            
            <!-- Jadual Rekod Pinjaman -->
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold text-purple-600 flex items-center">
                    Rekod Permohonan dan Pinjaman
                    <!-- Badge Notifikasi (Disalin dari Tab) -->
                    <span id="pending-badge-main" class="hidden ml-2 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-red-100 bg-red-600 rounded-full">0</span>
                </h2>
                <button id="clear-records-btn" class="bg-gray-500 hover:bg-gray-600 text-white text-sm font-semibold py-1 px-3 rounded-lg shadow transition duration-200">
                    Kosongkan Rekod Lama (Selesai/Ditolak)
                </button>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tindakan</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Guru</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">No. K/P</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aset Dipohon</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tarikh Pinjam</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tarikh Pulang</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tujuan</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                        </tr>
                    </thead>
                    <tbody id="loans-list" class="bg-white divide-y divide-gray-200">
                        <tr>
                            <td colspan="8" class="px-6 py-4 text-center text-gray-500 italic">Memuatkan rekod pinjaman...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <!-- Modal Log Masuk -->
    <div id="login-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 h-full w-full hidden z-50 flex items-center justify-center p-4">
        <div class="mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-medium text-gray-900">Log Masuk Admin</h3>
                <button id="close-login-modal" class="text-gray-400 hover:text-gray-600 text-3xl">&times;</button>
            </div>
            <form id="login-form" class="space-y-4">
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-700">E-mel</label>
                    <input type="email" id="email" name="email" required
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-gray-100">
                </div>
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700">Kata Laluan</label>
                    <input type="password" id="password" name="password" required
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-gray-100">
                </div>
                <button type="submit" id="login-submit"
                        class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow transition duration-200">
                    Log Masuk
                </button>
                <p id="login-error" class="text-sm text-red-600 mt-2"></p>
            </form>
        </div>
    </div>
    
    <!-- Modal Pengesahan (Confirm) -->
    <div id="confirm-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 h-full w-full hidden z-50 flex items-center justify-center p-4">
        <div class="mx-auto p-5 border w-full max-w-lg shadow-lg rounded-md bg-white">
            <h3 class="text-lg font-medium text-gray-900" id="confirm-title">Pengesahan</h3>
            <p class="text-sm text-gray-600 my-4" id="confirm-message">Anda pasti?</p>
            <div class="flex justify-end space-x-2">
                <button id="confirm-cancel" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-lg">
                    Batal
                </button>
                <button id="confirm-ok" class="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg">
                    Sahkan
                </button>
            </div>
        </div>
    </div>
    
    <!-- Modal Mesej (Alert) -->
    <div id="message-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 h-full w-full hidden z-50 flex items-center justify-center p-4">
        <div class="mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white">
            <h3 class="text-lg font-medium text-gray-900" id="message-title">Mesej Sistem</h3>
            <div class="text-sm text-gray-600 my-4" id="message-text"></div>
            <div class="flex justify-end">
                <button id="message-ok" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg">
                    OK
                </button>
            </div>
        </div>
    </div>
    
    <!-- Modal Edit Pinjaman -->
    <div id="edit-loan-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50 p-4">
        <div class="relative mx-auto my-8 p-5 border w-full max-w-lg shadow-lg rounded-md bg-white">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-medium text-gray-900">Edit Permohonan Pinjaman</h3>
                <button id="close-edit-modal" class="text-gray-400 hover:text-gray-600 text-3xl">&times;</button>
            </div>
            <form id="edit-loan-form" class="space-y-4">
                <input type="hidden" id="edit-loan-id">
                <div>
                    <label for="edit-teacherName" class="block text-sm font-medium text-gray-700">Nama Guru</label>
                    <input type="text" id="edit-teacherName" name="edit-teacherName" required
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-gray-100">
                </div>
                <div>
                    <label for="edit-teacherIC" class="block text-sm font-medium text-gray-700">No Kad Pengenalan</label>
                    <input type="text" id="edit-teacherIC" name="edit-teacherIC" required
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-gray-100">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="edit-startDate" class="block text-sm font-medium text-gray-700">Tarikh Pinjam</label>
                        <input type="date" id="edit-startDate" name="edit-startDate" required
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-gray-100">
                    </div>
                    <div>
                        <label for="edit-endDate" class="block text-sm font-medium text-gray-700">Tarikh Pulang</label>
                        <input type="date" id="edit-endDate" name="edit-endDate" required
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-gray-100">
                    </div>
                </div>
                <div>
                    <label for="edit-purpose" class="block text-sm font-medium text-gray-700">Tujuan Pinjaman</label>
                    <textarea id="edit-purpose" name="edit-purpose" rows="3" required
                              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-gray-100"></textarea>
                </div>
                <!-- Paparan Aset (tidak boleh diedit) -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">Aset (Tidak boleh diedit)</label>
                    <div id="edit-item-list" class="mt-1 p-3 bg-gray-100 rounded-md border border-gray-200 text-sm text-gray-600">
                        <!-- Senarai item akan diisi oleh JavaScript -->
                    </div>
                </div>
                <button type="submit" id="edit-loan-submit"
                        class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow transition duration-200">
                    Simpan Perubahan
                </button>
                <p id="edit-loan-error" class="text-sm text-red-600 mt-2"></p>
            </form>
        </div>
    </div>
    
    <!-- Modal Pengurus Aset (BARU) -->
    <div id="asset-manager-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50 p-4">
        <div class="relative mx-auto my-8 p-5 border w-full max-w-4xl shadow-lg rounded-md bg-white">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-medium text-gray-900">Pengurus Aset</h3>
                <button id="close-asset-manager-modal" class="text-gray-400 hover:text-gray-600 text-3xl">&times;</button>
            </div>
            <!-- Tapis Aset -->
            <div class="mb-4">
                <label for="asset-filter" class="block text-sm font-medium text-gray-700">Tapis Aset</label>
                <input type="text" id="asset-filter" placeholder="Taip nama aset untuk tapis..."
                       class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-gray-100">
            </div>
            <!-- Senarai Aset -->
            <div id="asset-manager-list" class="h-96 overflow-y-auto border border-gray-200 rounded-lg p-2 space-y-2">
                <!-- Aset akan diisi oleh JavaScript -->
                <p class="text-gray-500 text-sm italic">Memuatkan aset...</p>
            </div>
        </div>
    </div>
    
    <!-- Modal Edit Aset (BARU) -->
    <div id="edit-asset-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 overflow-y-auto h-full w-full hidden z-[60] p-4 flex items-center justify-center">
        <div class="relative p-5 border w-full max-w-lg shadow-lg rounded-md bg-white">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-medium text-gray-900">Edit Aset: <span id="edit-asset-name-title" class="font-bold"></span></h3>
                <button id="close-edit-asset-modal" class="text-gray-400 hover:text-gray-600 text-3xl">&times;</button>
            </div>
            <form id="edit-asset-form" class="space-y-4">
                <input type="hidden" id="edit-asset-id">
                <input type="hidden" id="edit-asset-groupName">
                
                <div>
                    <label for="edit-asset-name" class="block text-sm font-medium text-gray-700">Nama Aset</label>
                    <input type="text" id="edit-asset-name" required
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-gray-100">
                </div>
                <div>
                    <label for="edit-asset-category" class="block text-sm font-medium text-gray-700">Kategori</label>
                    <select id="edit-asset-category" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-gray-100">
                        <option value="Laptop">Laptop</option>
                        <option value="Tablet">Tablet</option>
                        <option value="Projector">Projector</option>
                        <option value="Lain">Lain-lain</option>
                    </select>
                </div>
                <div>
                    <label for="edit-asset-imageUrl" class="block text-sm font-medium text-gray-700">URL Gambar</label>
                    <input type="url" id="edit-asset-imageUrl" placeholder="Cth: https://i.imgur.com/gambar.png"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-gray-100">
                </div>
                <div>
                    <label for="edit-asset-specs" class="block text-sm font-medium text-gray-700">Spesifikasi (Satu per baris)</label>
                    <textarea id="edit-asset-specs" rows="4" placeholder="Cth:&#10;RAM: 8GB&#10;CPU: i5"
                              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-gray-100"></textarea>
                </div>
                
                <div class="pt-4 space-y-2">
                    <button type="submit" id="edit-asset-submit"
                            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow transition duration-200">
                        Simpan Maklumat Aset
                    </button>
                    <!-- Butang Salin ke Kumpulan (Hanya muncul jika ada groupName) -->
                    <button type="button" id="copy-to-group-btn"
                            class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg shadow transition duration-200 hidden">
                        Salin Gambar & Spec ke Kumpulan
                    </button>
                </div>
                <p id="edit-asset-status" class="text-sm mt-2"></p>
            </form>
        </div>
    </div>

    <!-- Pautan ke Fail JavaScript -->
    <script type="module" src="script.js" defer></script>
</body>
</html>

